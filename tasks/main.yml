---
 # tasks file for docker-ce
 #
 
 - name: add package daemon on servers
   apt:
    name:  "{{ item }}"
    state: present
   with_items:
      - apt-transport-https
      - ca-certificates
      - curl
      - software-properties-common
      - gnupg
      - lsb-release
 
 - name: add apt key ubuntu/docker
   apt_key:
     url: https://download.docker.com/linux/ubuntu/gpg
     state: present
   when: ansible_facts['distribution'] == "Ubuntu"

 - name:  add apt key debian/docker
   apt_key:
     url:  'https://download.docker.com/linux/{{ ansible_distribution | lower }}/gpg'
     state: present 
   when: ansible_facts['distribution']== "Debian" 
      
 - name: add debian package 
   apt_repository: 
    repo:  "deb [arch={{ ansible_architecture }}] https://download.docker.com/linux/{{ ansible_distribution | lower }} {{ ansible_distribution_release }} stable"
    state: present
   when: ansible_facts['distribution']== "Debian"

 - name: add apt repo
   apt_repository:
     repo: deb  https://download.docker.com/linux/ubuntu focal stable
     state: present
   when: ansible_facts['distribution'] == "Ubuntu"     
 
 - name: Update apt and install docker-ce/ubuntu
   apt:
     name: "{{ item }}"
     state: latest
     update_cache: yes
   with_items:
       - docker-ce
       - docker-ce-cli
   when: ansible_facts['distribution'] == "Ubuntu" 
 
 - name: Update apt and install docker-ce/debian
   apt:
     name: "{{ item }}"
     state: latest
     update_cache: yes  
   with_items: 
       - docker
       - docker.io
   when: ansible_facts['distribution']== "Debian"     
         
 - name: start docker service
   service:
       name: docker
       state: started
       enabled: yes
